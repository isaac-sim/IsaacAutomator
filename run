#!/bin/bash

SELF_DIR="$(realpath "$(dirname "${BASH_SOURCE}")")"
TAG="isaac_automator"

# build image if it doesn't exist
if [[ $(docker images -q "$TAG" 2> /dev/null) == '' ]]; then
  "${SELF_DIR}/build"
fi

# check if we're on mac
if [[ "$OSTYPE" == "darwin"* ]]; then
  # we're on mac - enable emulation
  docker run --platform linux/x86_64 -it --rm -v "${SELF_DIR}":/app $TAG "${*:-bash}"
else
  # we're not on mac
  docker run -it --rm -v "${SELF_DIR}":/app $TAG "${*:-bash}"
fi
